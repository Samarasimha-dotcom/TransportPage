{"ast":null,"code":"import * as i0 from \"@angular/core\";\nexport let RideService = /*#__PURE__*/(() => {\n  class RideService {\n    constructor() {\n      this.STORAGE_KEY_PREFIX = 'rides_';\n      this.TIME_BUFFER_MINUTES = 60;\n    }\n    todayKey() {\n      const d = new Date();\n      const yyyy = d.getFullYear();\n      const mm = String(d.getMonth() + 1).padStart(2, '0');\n      const dd = String(d.getDate()).padStart(2, '0');\n      return `${yyyy}-${mm}-${dd}`;\n    }\n    storageKeyForToday() {\n      return this.STORAGE_KEY_PREFIX + this.todayKey();\n    }\n    loadTodayRides() {\n      const key = this.storageKeyForToday();\n      const raw = localStorage.getItem(key);\n      return raw ? JSON.parse(raw) : [];\n    }\n    saveTodayRides(rides) {\n      const key = this.storageKeyForToday();\n      localStorage.setItem(key, JSON.stringify(rides));\n    }\n    toMinutes(time) {\n      const [h, m] = time.split(':').map(Number);\n      return h * 60 + m;\n    }\n    withinBuffer(target, reference) {\n      const t = this.toMinutes(target);\n      const r = this.toMinutes(reference);\n      return Math.abs(t - r) <= this.TIME_BUFFER_MINUTES;\n    }\n    addRide(input) {\n      // basic validations\n      if (!input.ownerEmployeeId.trim()) return {\n        ok: false,\n        error: 'Employee ID is required'\n      };\n      if (!input.vehicleNo.trim()) return {\n        ok: false,\n        error: 'Vehicle No is required'\n      };\n      if (!input.pickupPoint.trim()) return {\n        ok: false,\n        error: 'Pick-up Point is required'\n      };\n      if (!input.destination.trim()) return {\n        ok: false,\n        error: 'Destination is required'\n      };\n      if (!/^\\d{2}:\\d{2}$/.test(input.time)) return {\n        ok: false,\n        error: 'Time must be HH:mm'\n      };\n      if (input.vacantSeats == null || input.vacantSeats < 0) return {\n        ok: false,\n        error: 'Vacant Seats must be >= 0'\n      };\n      const rides = this.loadTodayRides();\n      // Employee ID unique for ride owners for today\n      const existsOwner = rides.some(r => r.ownerEmployeeId === input.ownerEmployeeId);\n      if (existsOwner) {\n        return {\n          ok: false,\n          error: 'This employee has already added a ride today'\n        };\n      }\n      const ride = {\n        id: crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2),\n        ownerEmployeeId: input.ownerEmployeeId.trim(),\n        vehicleType: input.vehicleType,\n        vehicleNo: input.vehicleNo.trim(),\n        vacantSeats: input.vacantSeats,\n        time: input.time,\n        pickupPoint: input.pickupPoint.trim(),\n        destination: input.destination.trim(),\n        bookings: [],\n        createdAt: Date.now()\n      };\n      rides.push(ride);\n      this.saveTodayRides(rides);\n      return {\n        ok: true\n      };\n    }\n    listRides(options) {\n      const rides = this.loadTodayRides();\n      let result = rides.slice();\n      if (options?.vehicleType && options.vehicleType !== 'All') {\n        result = result.filter(r => r.vehicleType === options.vehicleType);\n      }\n      if (options?.excludeOwner) {\n        result = result.filter(r => r.ownerEmployeeId !== options.excludeOwner);\n      }\n      if (options?.onlyWithSeats) {\n        result = result.filter(r => r.vacantSeats > 0);\n      }\n      // Time matching with +/- 60 minutes if a reference is given, else use current time\n      const ref = options?.timeReference || this.currentTimeHHmm();\n      result = result.filter(r => this.withinBuffer(r.time, ref));\n      // sort by time ascending\n      result.sort((a, b) => this.toMinutes(a.time) - this.toMinutes(b.time));\n      return result;\n    }\n    bookRide(rideId, employeeId) {\n      if (!employeeId.trim()) return {\n        ok: false,\n        error: 'Employee ID is required'\n      };\n      const rides = this.loadTodayRides();\n      const idx = rides.findIndex(r => r.id === rideId);\n      if (idx === -1) return {\n        ok: false,\n        error: 'Ride not found'\n      };\n      const ride = rides[idx];\n      if (ride.ownerEmployeeId === employeeId) {\n        return {\n          ok: false,\n          error: 'You cannot book your own ride'\n        };\n      }\n      if (ride.bookings.includes(employeeId)) {\n        return {\n          ok: false,\n          error: 'You cannot book the same ride twice'\n        };\n      }\n      if (ride.vacantSeats <= 0) {\n        return {\n          ok: false,\n          error: 'No vacant seats available'\n        };\n      }\n      ride.bookings.push(employeeId);\n      ride.vacantSeats -= 1;\n      rides[idx] = ride;\n      this.saveTodayRides(rides);\n      return {\n        ok: true\n      };\n    }\n    currentTimeHHmm() {\n      const d = new Date();\n      const hh = String(d.getHours()).padStart(2, '0');\n      const mm = String(d.getMinutes()).padStart(2, '0');\n      return `${hh}:${mm}`;\n    }\n    static {\n      this.ɵfac = function RideService_Factory(t) {\n        return new (t || RideService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: RideService,\n        factory: RideService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return RideService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}